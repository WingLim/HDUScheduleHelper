function Util(){}if(Util.hasClass=function(e,t){return e.classList?e.classList.contains(t):!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},Util.addClass=function(e,t){var n=t.split(" ");e.classList?e.classList.add(n[0]):Util.hasClass(e,n[0])||(e.className+=" "+n[0]),n.length>1&&Util.addClass(e,n.slice(1).join(" "))},Util.removeClass=function(e,t){var n=t.split(" ");if(e.classList)e.classList.remove(n[0]);else if(Util.hasClass(e,n[0])){var l=new RegExp("(\\s|^)"+n[0]+"(\\s|$)");e.className=e.className.replace(l," ")}n.length>1&&Util.removeClass(e,n.slice(1).join(" "))},Util.toggleClass=function(e,t,n){n?Util.addClass(e,t):Util.removeClass(e,t)},Util.setAttributes=function(e,t){for(var n in t)e.setAttribute(n,t[n])},Util.getChildrenByClassName=function(e,t){e.children;for(var n=[],l=0;l<e.children.length;l++)Util.hasClass(e.children[l],t)&&n.push(e.children[l]);return n},Util.is=function(e,t){if(t.nodeType)return e===t;for(var n="string"==typeof t?document.querySelectorAll(t):t,l=n.length;l--;)if(n[l]===e)return!0;return!1},Util.setHeight=function(e,t,n,l,a){var s=t-e,i=null,o=function(t){i||(i=t);var d=t-i,r=parseInt(d/l*s+e);n.style.height=r+"px",d<l?window.requestAnimationFrame(o):a()};n.style.height=e+"px",window.requestAnimationFrame(o)},Util.scrollTo=function(e,t,n,l){var a=l||window,s=a.scrollTop||document.documentElement.scrollTop,i=null;l||(s=window.scrollY||document.documentElement.scrollTop);var o=function(l){i||(i=l);var d=l-i;d>t&&(d=t);var r=Math.easeInOutQuad(d,s,e-s,t);a.scrollTo(0,r),d<t?window.requestAnimationFrame(o):n&&n()};window.requestAnimationFrame(o)},Util.moveFocus=function(e){e||(e=document.getElementsByTagName("body")[0]),e.focus(),document.activeElement!==e&&(e.setAttribute("tabindex","-1"),e.focus())},Util.getIndexInArray=function(e,t){return Array.prototype.indexOf.call(e,t)},Util.cssSupports=function(e,t){return"CSS"in window?CSS.supports(e,t):e.replace(/-([a-z])/g,(function(e){return e[1].toUpperCase()}))in document.body.style},Util.extend=function(){var e={},t=!1,n=0,l=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(t=arguments[0],n++);for(var a=function(n){for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(t&&"[object Object]"===Object.prototype.toString.call(n[l])?e[l]=extend(!0,e[l],n[l]):e[l]=n[l])};n<l;n++){var s=arguments[n];a(s)}return e},Util.osHasReducedMotion=function(){if(!window.matchMedia)return!1;var e=window.matchMedia("(prefers-reduced-motion: reduce)");return!!e&&e.matches},Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;if(!document.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}),"function"!=typeof window.CustomEvent){function CustomEvent(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}CustomEvent.prototype=window.Event.prototype,window.CustomEvent=CustomEvent}Math.easeInOutQuad=function(e,t,n,l){return(e/=l/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},function(){var e=document.getElementsByClassName("js-tab-focus");function t(){e.length>0&&(l(!1),window.addEventListener("keydown",n)),window.removeEventListener("mousedown",t)}function n(e){9===e.keyCode&&(l(!0),window.removeEventListener("keydown",n),window.addEventListener("mousedown",t))}function l(t){for(var n=t?"":"none",l=0;l<e.length;l++)e[l].style.setProperty("outline",n)}window.addEventListener("mousedown",t)}();let insert=(e,t)=>{ul=document.getElementById(e),ul.insertAdjacentHTML("beforeend",t)},create=(e,t,n,l)=>(range=parseInt(3*Math.random()+1),html=`<li class="cd-schedule__event">\n        <a data-start="${e}" data-end="${t}" href="#0" data-content="${l}" data-event="event-${range}">\n            <em class="cd-schedule__name">${n}</em>\n           \n        </a>\n        </li>`,html);function ScheduleTemplate(e){this.element=e,this.timelineItems=this.element.getElementsByClassName("cd-schedule__timeline")[0].getElementsByTagName("li"),this.timelineStart=getScheduleTimestamp(this.timelineItems[0].textContent),this.timelineUnitDuration=getScheduleTimestamp(this.timelineItems[1].textContent)-getScheduleTimestamp(this.timelineItems[0].textContent),this.topInfoElement=this.element.getElementsByClassName("cd-schedule__top-info")[0],this.singleEvents=this.element.getElementsByClassName("cd-schedule__event"),this.modal=this.element.getElementsByClassName("cd-schedule-modal")[0],this.modalHeader=this.element.getElementsByClassName("cd-schedule-modal__header")[0],this.modalHeaderBg=this.element.getElementsByClassName("cd-schedule-modal__header-bg")[0],this.modalBody=this.element.getElementsByClassName("cd-schedule-modal__body")[0],this.modalBodyBg=this.element.getElementsByClassName("cd-schedule-modal__body-bg")[0],this.modalClose=this.modal.getElementsByClassName("cd-schedule-modal__close")[0],this.modalDate=this.modal.getElementsByClassName("cd-schedule-modal__date")[0],this.modalEventName=this.modal.getElementsByClassName("cd-schedule-modal__name")[0],this.coverLayer=this.element.getElementsByClassName("cd-schedule__cover-layer")[0],this.modalMaxWidth=800,this.modalMaxHeight=480,this.animating=!1,this.supportAnimation=Util.cssSupports("transition"),this.initSchedule()}function getScheduleTimestamp(e){var t=(e=e.replace(/ /g,"")).split(":");return 60*parseInt(t[0])+parseInt(t[1])}function renderSchedule(){var e=document.getElementsByClassName("js-cd-schedule"),t=[],n=!1;if(e.length>0){for(var l=0;l<e.length;l++)!function(n){t.push(new ScheduleTemplate(e[n]))}(l);function a(){for(var e=0;e<t.length;e++)t[e].scheduleReset();n=!1}window.addEventListener("resize",(function(e){n||(n=!0,window.requestAnimationFrame?window.requestAnimationFrame(a):setTimeout(a,250))})),window.addEventListener("keyup",(function(e){if(e.keyCode&&27==e.keyCode||e.key&&"escape"==e.key.toLowerCase())for(var n=0;n<t.length;n++)t[n].closeModal()}))}}axios.get("https://api.limxw.com/schedule/json/18011317").then((function(e){r=e,e.data.forEach(e=>{switch(time=e.timeinfo,info=`${e.teacher}+${time.week.start}+${time.week.end}+${time.week.flag}+${e.location}`,ele=create(time.start,time.end,e.name,info),time.weekday){case 1:insert("1",ele);break;case 2:insert("2",ele);break;case 3:insert("3",ele);break;case 4:insert("4",ele);break;case 5:insert("5",ele);break;case 6:insert("6",ele);break;case 7:insert("7",ele)}}),renderSchedule()})).catch((function(e){console.log(e)})),ScheduleTemplate.prototype.initSchedule=function(){this.scheduleReset(),this.initEvents()},ScheduleTemplate.prototype.scheduleReset=function(){var e=this.mq(),t=Util.hasClass(this.element,"js-schedule-loaded"),n=Util.hasClass(this.modal,"cd-schedule-modal--open");"desktop"!=e||t?"mobile"==e&&t?(Util.removeClass(this.element,"cd-schedule--loading js-schedule-loaded"),this.resetEventsStyle(),n&&this.checkEventModal()):"desktop"==e&&n?(this.checkEventModal(n),Util.removeClass(this.element,"cd-schedule--loading")):Util.removeClass(this.element,"cd-schedule--loading"):(Util.addClass(this.element,"js-schedule-loaded"),this.placeEvents(),n&&this.checkEventModal(n))},ScheduleTemplate.prototype.resetEventsStyle=function(){for(var e=0;e<this.singleEvents.length;e++)this.singleEvents[e].removeAttribute("style")},ScheduleTemplate.prototype.placeEvents=function(){for(var e=this.topInfoElement.offsetHeight,t=0;t<this.singleEvents.length;t++){var n=this.singleEvents[t].getElementsByTagName("a")[0],l=getScheduleTimestamp(n.getAttribute("data-start")),a=getScheduleTimestamp(n.getAttribute("data-end"))-l,s=e*(l-this.timelineStart)/this.timelineUnitDuration,i=e*a/this.timelineUnitDuration;this.singleEvents[t].setAttribute("style","top: "+(s-1)+"px; height: "+(i+1)+"px")}Util.removeClass(this.element,"cd-schedule--loading")},ScheduleTemplate.prototype.initEvents=function(){for(var e=this,t=0;t<this.singleEvents.length;t++)this.singleEvents[t].addEventListener("click",(function(t){t.preventDefault(),e.animating||e.openModal(this.getElementsByTagName("a")[0])}));this.modalClose.addEventListener("click",(function(t){t.preventDefault(),e.animating||e.closeModal()})),this.coverLayer.addEventListener("click",(function(t){t.preventDefault(),e.animating||e.closeModal()}))},ScheduleTemplate.prototype.openModal=function(e){var t=this,n=t.mq();if(this.animating=!0,this.modalEventName.textContent=e.getElementsByTagName("em")[0].textContent,this.modalDate.textContent=e.getAttribute("data-start")+" - "+e.getAttribute("data-end"),this.modal.setAttribute("data-event",e.getAttribute("data-event")),this.addCourseInfo(e.getAttribute("data-content")),Util.addClass(this.modal,"cd-schedule-modal--open"),setTimeout((function(){Util.addClass(e.closest("li"),"cd-schedule__event--selected")}),10),"mobile"==n)t.modal.addEventListener("transitionend",(function e(){t.animating=!1,t.modal.removeEventListener("transitionend",e)}));else{var l=e.getBoundingClientRect(),a=l.top,s=l.left,i=e.offsetHeight,o=e.offsetWidth,d=window.innerWidth,r=window.innerHeight,m=.8*d>t.modalMaxWidth?t.modalMaxWidth:.8*d,c=.8*r>t.modalMaxHeight?t.modalMaxHeight:.8*r,h=parseInt((d-m)/2-s),u=parseInt((r-c)/2-a),p=c/i,g=m-o;t.modal.setAttribute("style","top:"+a+"px;left:"+s+"px;height:"+c+"px;width:"+m+"px;transform: translateY("+u+"px) translateX("+h+"px)"),t.modalHeader.setAttribute("style","width:"+o+"px"),t.modalBody.setAttribute("style","margin-left:"+o+"px"),t.modalBodyBg.setAttribute("style","height:"+i+"px; width: 1px; transform: scaleY("+p+") scaleX("+g+")"),t.modalHeaderBg.setAttribute("style","height: "+i+"px; width: "+o+"px; transform: scaleY("+p+")"),t.modalHeaderBg.addEventListener("transitionend",(function e(){t.animating=!1,Util.addClass(t.modal,"cd-schedule-modal--animation-completed"),t.modalHeaderBg.removeEventListener("transitionend",e)}))}this.animationFallback()},ScheduleTemplate.prototype.closeModal=function(){var e=this,t=e.mq(),n=e.element.getElementsByClassName("cd-schedule__event--selected")[0],l=n.getElementsByTagName("a")[0];if(this.animating=!0,"mobile"==t)Util.removeClass(this.modal,"cd-schedule-modal--open"),e.modal.addEventListener("transitionend",(function t(){Util.removeClass(e.modal,"cd-schedule-modal--content-loaded"),Util.removeClass(n,"cd-schedule__event--selected"),e.animating=!1,e.modal.removeEventListener("transitionend",t)}));else{var a=l.getBoundingClientRect(),s=a.top,i=a.left,o=l.offsetHeight,d=l.offsetWidth,r=window.getComputedStyle(e.modal),m=Number(r.getPropertyValue("top").replace("px","")),c=i-Number(r.getPropertyValue("left").replace("px","")),h=s-m;Util.removeClass(this.modal,"cd-schedule-modal--open cd-schedule-modal--animation-completed"),e.modal.style.width=d+"px",e.modal.style.height=o+"px",e.modal.style.transform="translateX("+c+"px) translateY("+h+"px)",e.modalBodyBg.style.transform="scaleX(0) scaleY(1)",e.modalHeaderBg.style.transform="scaleY(1)",e.modalHeaderBg.addEventListener("transitionend",(function t(){Util.addClass(e.modal,"cd-schedule-modal--no-transition"),setTimeout((function(){e.modal.removeAttribute("style"),e.modalBody.removeAttribute("style"),e.modalHeader.removeAttribute("style"),e.modalHeaderBg.removeAttribute("style"),e.modalBodyBg.removeAttribute("style")}),10),setTimeout((function(){Util.removeClass(e.modal,"cd-schedule-modal--no-transition")}),20),e.animating=!1,Util.removeClass(e.modal,"cd-schedule-modal--content-loaded"),Util.removeClass(n,"cd-schedule__event--selected"),e.modalHeaderBg.removeEventListener("transitionend",t)}))}this.animationFallback()},ScheduleTemplate.prototype.checkEventModal=function(e){this.animating=!0;var t=this,n=this.mq();if("mobile"==n)t.modal.removeAttribute("style"),t.modalBody.removeAttribute("style"),t.modalHeader.removeAttribute("style"),t.modalHeaderBg.removeAttribute("style"),t.modalBodyBg.removeAttribute("style"),Util.removeClass(t.modal,"cd-schedule-modal--no-transition"),t.animating=!1;else if("desktop"==n&&e){Util.addClass(t.modal,"cd-schedule-modal--no-transition cd-schedule-modal--animation-completed");var l=t.element.getElementsByClassName("cd-schedule__event--selected")[0].getElementsByTagName("a")[0],a=l.getBoundingClientRect(),s=(a.top,a.left,l.offsetHeight),i=l.offsetWidth,o=window.innerWidth,d=window.innerHeight,r=.8*o>t.modalMaxWidth?t.modalMaxWidth:.8*o,m=.8*d>t.modalMaxHeight?t.modalMaxHeight:.8*d,c=m/s,h=r-i;setTimeout((function(){t.modal.setAttribute("style","top:"+(d/2-m/2)+"px;left:"+(o/2-r/2)+"px;height:"+m+"px;width:"+r+"px;transform: translateY(0) translateX(0)"),t.modalBodyBg.style.height=m+"px",t.modalBodyBg.style.transform="scaleY(1) scaleX("+h+")",t.modalBodyBg.style.width="1px",t.modalHeader.setAttribute("style","width:"+i+"px"),t.modalBody.setAttribute("style","margin-left:"+i+"px"),t.modalHeaderBg.setAttribute("style","height: "+s+"px;width:"+i+"px; transform:scaleY("+c+");")}),10),setTimeout((function(){Util.removeClass(t.modal,"cd-schedule-modal--no-transition"),t.animating=!1}),20)}},ScheduleTemplate.prototype.addCourseInfo=function(e){switch(info=e.split("+"),info[3]){case"1":flag="单周";break;case"2":flag="双周";break;default:flag="每周"}CourseInfo=`\n        <div>\n            <h1>详细信息</h1>\n            <h2>任课老师：${info[0]}</h2>\n            <h2>上课教室：${info[4]}</h2>\n            <h2>开始结束周：${info[1]} - ${info[2]}</h2>\n            <h2>周次：${flag}</h2>\n        </div>\n        `,this.modal.getElementsByClassName("cd-schedule-modal__event-info")[0].innerHTML=CourseInfo,Util.addClass(this.modal,"cd-schedule-modal--content-loaded")},ScheduleTemplate.prototype.getEventContent=function(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.getElementsByClassName("cd-schedule-modal__event-info")[0].innerHTML},ScheduleTemplate.prototype.animationFallback=function(){if(!this.supportAnimation){var e=new CustomEvent("transitionend");self.modal.dispatchEvent(e),self.modalHeaderBg.dispatchEvent(e)}},ScheduleTemplate.prototype.mq=function(){return window.getComputedStyle(this.element,"::before").getPropertyValue("content").replace(/'|"/g,"")};